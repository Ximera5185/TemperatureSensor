#include "max6675.h"
#include <EEPROM.h>

int thermoDO = 2;  //он же SO
int thermoCS = 3;
int thermoCLK = 4;  //он же SCK
int ledPin = 13; // переменная с пином подключенного светодиода
int temperature;
int criticalTemperature  ;
int lastCritical;

String inputDataTemperaturePort = "";

MAX6675 thermocouple(thermoCLK, thermoCS, thermoDO);

int vccPin = 5;  //пин для питания
int gndPin = 6;  //пин для земли
String key = "term";
String package;

void setup() 
  {
      Serial.begin(9600);
      //активируем питание и землю
      pinMode(vccPin, OUTPUT); digitalWrite(vccPin, HIGH);
      pinMode(gndPin, OUTPUT); digitalWrite(gndPin, LOW);
      pinMode(ledPin,OUTPUT); // назначаем наш пин выходом

      //ждем стабилизации чипа MAX
      delay(500);
  }

void loop() 
  {
    criticalTemperature = 100;
      //Выводим показания в монитор порта
        //Serial.println((int)thermocouple.readCelsius());
        temperature = (int)thermocouple.readCelsius();
        //package = key + (int)thermocouple.readCelsius();
        package = key + temperature;
        
        Serial.println(package);

         inputDataTemperaturePort = Serial.readString();

         criticalTemperature  = inputDataTemperaturePort.toInt();

         if(criticalTemperature > 0)
           {
            EEPROM.update(0, criticalTemperature);
           }
          
           

         // lastCritical = criticalTemperature;
      // if(Serial.available()  0)
      //   {
            
      //   }
      // else
      //   {
        //   criticalTemperature =  lastCritical;
  
        // }

        //criticalTemperature = inputDataTemperaturePort.toInt();

        //Serial.println(EEPROM.read(0));
       // Serial.println(lastCritical);

        TurnAlarm(EEPROM.read(0));
    
       delay(1000); // Найти у Гайвера цикл таймера Gyver
  }

void TurnAlarm(int criticalTemperature)
{
  if(temperature > criticalTemperature)
  {
    digitalWrite(ledPin,HIGH);
  }
  else
  {
    digitalWrite(ledPin,LOW);
  }
}